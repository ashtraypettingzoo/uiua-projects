# Experimental!
# Uiua 0.13.0-dev.2
# https://github.com/ashtraypettingzoo/uiua-projects/blob/main/Wavetables/wavetables.ua
# https://uiua.org/pad?src=0_13_0-dev_2__IyBFeHBlcmltZW50YWwhCiMgVWl1YSAwLjEzLjAtZGV2LjIKIyBodHRwczovL2dpdGh1Yi5jb20vYXNodHJheXBldHRpbmd6b28vdWl1YS1wcm9qZWN0cy9ibG9iL21haW4vV2F2ZXRhYmxlcy93YXZldGFibGVzLnVhCiMgW3VybF0KCiMgVE9ETzogaGlnaC9sb3cgcGFzcyBmaWx0ZXJzCiMgVE9ETzogSVIgaW1wb3J0aW5nCiMgVE9ETzogZml4IFN0ciAoc3RyZXRjaCkgYnV6emluZwojIFRPRE86IFNpZCAoc2lkZSBieSBzaWRlKQojIFRPRE86IFNocCAod2F2ZXNoYXBlKQoKUyDihpAgMjA0OCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNhbXBsZXMgcGVyIG9zY2lsbGF0b3IKTyDihpAgMjU2ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE9zY2lsbGF0b3JzIHBlciB0YWJsZQpUIOKGkCDDl1MgTyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNhbXBsZXMgcGVyIHRhYmxlClNVIOKGkCDDtzIrMSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU2lnbmVkIHRvIHVuc2lnbmVkClVTIOKGkCAtMcOXMiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVW5zaWduZWQgdG8gc2lnbmVkCk9VIOKGkCDDt-KfnOKHoVMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE9zY2lsbGF0b3IgYmFzZSwgdW5zaWduZWQgMC0xCk9UIOKGkCDDl8-ET1UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE9zY2lsbGF0b3IgYmFzZSwgdHJpZ29ub21ldHJpYyAwLTLPgApSIOKGkCDihq_CpFQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgT3NjaWxsYXRvciB0byB0YWJsZSAocmVwZWF0KQpVIOKGkCDijaUo4oqi4o2J4oav4oqfOuKfnMO3MuKKuOKnuykgICAgICAgICAgICAgICAgICAgICAgICAgIyBPY3RhdmUgdXAgKGZvciBwbGF5YmFjayBvbmx5KQpHSCDihpAgMjAwICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgR3JhcGggaGVpZ2h0CkMg4oaQIOKGpcKvMeKGpzEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENsYW1wClNXIOKGkCDiio_il7_ip7ssICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTZWxlY3QgKHdyYXBwZWQpClNJIOKGkCAr4oqZw5fin5wt4oqD4oqDKFNX4oyKKShTV-KMiCkoLeKKuOKMiikgICAgICAgICAgICAgICAjIFNlbGVjdCAoaW50ZXJwb2xhdGVkKQpSSSDihpAgU0nDl-KHoTrDtyzip7ssICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzaXplIChpbnRlcnBvbGF0ZWQpCkNTIOKGkCDiiL8rzrcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDb3NpbmUKTlIg4oaQIOKGp-KKuOKGpSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE5hTiByZXBsYWNlClNDIOKGkCBOUjHDt-KfnOKIvyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNpbmMKVkIg4oaQIMO3LTHin5zih6FPICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVmFsdWUgYmFzZQpWUiDihpAgK-KKmcOXOi3in5w6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBWYWx1ZSByYW5nZSBbbWluLCBtYXgsIHZhbHVlc10KR0wg4oaQIDE2ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEdJRiBsZW5ndGggKGZyYW1lcykKU0gg4oaQIDIwMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNwZWN0cnVtIGdyYXBoIGhlaWdodApGViDihpAgw7cy4oiaUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRm91cmllciBtYXggdmFsdWUKU1Yg4oaQICsx4oyKw5fDtzJT4oG_MsO34p-c4oehw7c0UyAgICAgICAgICAgICAgICAgICAgICAjIFNwZWN0cnVtIGluZGV4IHZhbHVlcwpJUyDihpAg4qisKCZnaWZzMTV8Jmltcyk9MuKnu-KWsy4gICAgICAgICAgICAgICAgICMgU2hvdyBpbWFnZSBvciBnaWYKU00g4oaQIOKHjOKIpyjiioIr4oq44oqD4ouF4oiYKMOX4oqZ4ouF4oqiKSniipkoOsKkwrDiioIpICAgICAgICAgICAgICAjIFNjYW4gYWRkICsgbXVsdGlwbHkKTUIg4oaQIMO3OjHigb8xNiAyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE1pbmltdW0gMTYtYml0IHZhbHVlCkZUIOKGkCDiioMo4oigwrDihIIpKMO3RlbijLUp4oaZKzHDtzJTIGZmdCAgICAgICAgICAgICAgICMgRm91cmllciB0cmFuc2Zvcm0gW3BoYXNlLCBhbXAg4oaQIHdhdmVdCkZVIOKGkCDil4zCsOKEgsKwZmZ04oqCOuKNnMKw4oSCwq_ihpgx4oeM4oaYMS7ihILiioMow5fiiL8pKMOXQ1Mp4oqZKMOXRlYpICMgRm91cmllciB1bnRyYW5zZm9ybSBbd2F2ZSDihpAgcGhhc2UsIGFtcF0KRFMg4oaQIHwxIOKNpSjiioI6Ii8iKT4w4qe7LgpUcnVlIOKGkCAxICAjIFRydWUgY29uc3RhbnQKRmFsc2Ug4oaQIDAgIyBGYWxzZSBjb25zdGFudApS4oKAIOKGkCDimIcwICAgIyBSZXJhbmsgemVybwpS4oKBIOKGkCDimIcxICAgIyBSZXJhbmsgb25lClYhIOKGkCBS4oKB4omhXiFS4oKAClZWISDihpAgUuKCgeKJoV4hUuKCgOKKmVLigoAKVlZBISDihpAgUuKCgeKJoV4hUuKCgOKKmVLigoDiipniiplS4oKBClZBISDihpAgUuKCgeKJoV4hUuKCgOKKmVLigoEKVkFBISDihpAgUuKCgeKJoV4hUuKCgOKKmVLigoHiipniiplS4oKBCkEhIOKGkCBS4oKB4omhXiFS4oKBCkFBISDihpAgUuKCgeKJoV4hUuKCgeKKmVLigoEKCiMgLS0tLSBDb252b2x1dGlvbnMKIyBJZGVudGl0eSAoZGVsdGEpIGNvbnZvbHV0aW9uCkNJZCDihpAgwqTCpDEKCiMgLS0tLSBUYWJsZSB2YWx1ZXMKIyBWYWx1ZXMgKGxpbmVhcikgW21pbiwgbWF4XQpWYWwg4oaQIFZS4oqZ4oqZKFZCKQojIFZhbHVlcyAocG93ZXIgaW4pIFttaW4sIG1heCwgYmFzZV0KVmFsUEkg4oaQIFZS4oqZ4oqZKOKBvzpWQikKIyBWYWx1ZXMgKHBvd2VyIG91dCkgW21pbiwgbWF4LCBiYXNlXQpWYWxQTyDihpAg4oeMVmFsUEk6CgojIC0tLS0gSGVscGVycwojIFJhbmRvbSAobWluLW1heCkgW01pbiwgTWF4XQpSbmQg4oaQICvDl-Kagjrin5wtCiMgUmFuZG9tIChtaW4tbWF4KSBbTWluLCBNYXhdClJuZEkg4oaQIOKMilJuZDorMTrijaU6PCwsCgojIC0tLS0gV2F2ZSBPcGVyYXRpb25zCiMgU3VtIFt7V2F2ZXMvVGFibGVzfV0KU3VtIOKGkCDCsOKWoS8r4o2aUuKCgQojIEF2ZXJhZ2UgW3tXYXZlcy9UYWJsZXN9XQpBdmcg4oaQIFN1bcO34oq44qe7CiMgQW1wbGlmeSBbQW1vdW50LCBXYXZlL1RhYmxlXQpBbXAg4oaQIFZBIcOXCiMgTWF4aW1pemUgW1dhdmUvVGFibGVdCk1heCDihpAgQSEo4peM4o2l4p-cw7fiiaAwLuKGpeKIqS_ihqXin5zCry4pCiMgUGhhc2Ugc2hpZnQgW0Ftb3VudCwgV2F2ZS9UYWJsZV0KUGhzIOKGkCBWQSEo4oa74oGFw5fip7ssKQojIFBoYXNlIHNoaWZ0IHRvIHplcm8gcG9pbnQgW1dhdmUvVGFibGVdClplciDihpAgQSEo4oa74oqXL-KGp-KMtS4uKQojIEJpdGNydXNoIFtBbW91bnQgKDAtMSksIFdhdmUvVGFibGVdCkJpdCDihpAgVkEhKFVT4oanMcO3LTE64oyKw5csU1U64oGF4oG_OjIrMcOXMTUtOjHiiJrihqcx4oalMCkKIyBSZXZlcnNlIFtXYXZlL1RhYmxlXQpSZXYg4oaQIEEh4oeMCiMgSW52ZXJ0IFtXYXZlL1RhYmxlXQpJbnYg4oaQIEEhwq8KIyBNaXJyb3IgMXN0IGhhbGYgW1dhdmUvVGFibGVdCk1pciDihpAgQSEo4oqC4oeMLuKGmcO3MlMpCiMgRmFkZSBzdGFydCAmIGVuZCBbQW1vdW50ICgwLTEpLCBXYXZlL1RhYmxlXQpGYWQg4oaQIFZBISjih4zirJoxw5fih4w64qyaMeKfnMOXw7fip7su4oeh4oyKw7cyw5dT4oalMCkKIyBDcm9zc2ZhZGUgW0Ftb3VudCAoMC0xKSwgU3RhcnQgV2F2ZS9UYWJsZSwgRW5kIFdhdmUvVGFibGVdCkNycyDihpAgVkFBISgr4oqZKMOXLToxKTrin5zDl-KKmTopCiMgU3RyZXRjaCBbVG8gKDAtMSksIEZyb20gKDAtMSksIFdhdmUvVGFibGVdClN0ciDihpAgVlZBISjiioLiiplSSTotOlPin5xSSeKKmeKKg-KGmeKGmOKIqSjihqctMVPihqUx4oGFw5dT4oanMeKGpTApKQojIFNoaWZ0IHVwL2Rvd24gW0Ftb3VudCAowq8xLTEpLCBXYXZlL1RhYmxlXQpTaGYg4oaQIFZBISgrKQojIFNsaWNlIFtBbW91bnQgKDAtMSksIFdhdmUvVGFibGVdClNsYyDihpAgVkEhKFJJIFPihq_ima3igYXihqUxw5dTKQojIFNwZWVkIHVwL2Rvd24gW09jdGF2ZXMsIFdhdmUvVGFibGVdClNwZCDihpAgVkEhKFNsY-KBvzoyKQojIFNwbGljZSBbQW1vdW50ICgwLTEpLCBXYXZlL1RhYmxlIDEsIFdhdmUvVGFibGUgMl0KU3BsIOKGkCBWQUEhKOKKguKKk-KGmeKGmOKfnDrigYXDl1Pihqcx4oalMCkKIyBDbGlwCkNscCDihpAgQSEoQykKIyBXcmFwIFtXYXZlL1RhYmxlXQpXcnAg4oaQIEEhKFVT4pe_K01CMVNVKQojIEFtcGx1dHVkZSBtb2R1bGF0aW9uIFtBbXBsaXR1ZGUsIE1vZHVsYXRvciwgQ2Fycmllcl0KQU0g4oaQIFZBQSEow5crMcO3MsOXLTE6KQojIFJpbmcgbW9kdWxhdGlvbiBbTW9kdWxhdG9yLCBDYXJyaWVyXQpSTSDihpAgQUEhw5cKIyBGcmVxdWVuY3kgbW9kdWxhdGlvbiBbQW1wbGl0dWRlLCBNb2R1bGF0b3IsIENhcnJpZXJdCkZNIOKGkCBWQUEhKFNJw5dTK09Vw5cpCiMgQ29udm9sdmUgW0ltcHVsc2UsIFdhdmUvVGFibGVdCkNudiDihpAgQUEhKC8rw5fijYnil6viipko4oav4pmtKTotMeKKuCvip7ss4qe74p-cOikKIyBQaGFzZSByYW5kb21pemUgW0Ftb3VudCAoMC0xKSwgV2F2ZS9UYWJsZV0KUGhyIOKGkCDiiaEoRlU64oqZKzpGVCk64omhw5dS4oKBLc-Aw5fPhOKNpSjiioLimoIpKzHDtzJTW11S4oKA4oqZUuKCgQojIEhhcm1vbmljIHdhdmUgZmlsdGVyIFtBbW91bnQgKDAtMSksIEZpbHRlciBXYXZlL1RhYmxlLCBTb3VyY2UgV2F2ZS9UYWJsZV0KSHdmIOKGkCBWQUEhKEZV4oqZw5c6KzHDl-KKmSgtMeKXjOKIqUZUKSkKIyBEb3duc2FtcGxlIFtBbW91bnQgKDAtMSksIFdhdmUvVGFibGVdCkR3biDihpAgVkEhKAogIOKMiMO3OlMu4oGF4oalMeKBvzoyKzHDly0x4oKZMlMtOjEKICDihq_CpFPijYnihq_in5zDt-KfnCjiiaEvK-KGr-KKgjopCikKCiMgLS0tLSBUYWJsZSBvcGVyYXRpb25zCiMgQ29tYiBmaWx0ZXIgKGZlZWRiYWNrKSBbQW1wbGl0dWRlLCBIYXJtb25pYywgVGFibGVdClRDbWIg4oaQIOKGr09fUyBTTeKKmSjirJow4oav4oqC4oyIw7c6VC7igYXDtzpT4oqZUikKIyBDb21iIGZpbHRlciAoZmVlZGZvcndhcmQpIFtBbXBsaXR1ZGUsIEhhcm1vbmljLCBUYWJsZV0KVENtZiDihpAg4oavT19TK8OX4oqZKOKKguKGrzpbMF3CpOKfnOKGmOKMisO3OsKvU-KKmSguUikpCgojIC0tLS0gV2F2ZWZvcm1zCiMgU2luZSB3YXZlIFtIYXJtb25pY10KU2luIOKGkCBWISjiiL_DlzpPVCkKIyBTYXcgd2F2ZSBbSGFybW9uaWNdClNhdyDihpAgViEoVVPil78xw5c6T1UpCiMgVHJpYW5nbGUgd2F2ZSBbSGFybW9uaWNdClRyaSDihpAgViEoVVPijLVVU-KXvzErMC4yNcKvw5c6T1UpCiMgUHVsc2Ugd2F2ZSBbSGFybW9uaWMsIER1dHldClB1bCDihpAgVlYhKFVT4omkVVM6U2F3KQojIFNxdWFyZSB3YXZlIFtIYXJtb25pY10KU3FyIOKGkCBWIShQdWw6MC41KQojIE5vaXNlIHdhdmUgW10KTnN3IOKGkCAo4piHMVVT4o2lKOKKguKagilTW10pCgojIC0tLS0gVGFibGVzCiMgTm9pc2UgdGFibGUgW10KTnN0IOKGkCAo4o2lKOKKgk5zdylPW10pCgojIC0tLS0gU2V0dGluZ3MKRGVza3RvcCDihpAgRmFsc2UKT3V0RGlyQXVkaW8g4oaQICJvdXQiCgojIC0tLS0gVXRpbGl0eQpQcmludCDihpAgJnBmCkV4cG9ydCDihpAgJmFwIEPima0KVGVzdCDihpAgJmFwIFUzUiBD4pmtCkdyYXBoIOKGkCBJU-KNouKKoig9MeKnuyniiaEo4oeM4qyaMeKKnuKJoOKHoUdI4oGFw5ctMUdIIFNVIFUyQynilr09MOKHoeKMisO3R0wgTwpJbWFnZSDihpAgJmltc-KGr09fUyBTVSBSIEPima0KSW1wb3J0SW1hZ2Ug4oaQIFJJIE_iiaFSSSBT4o2c4o2J4omhKMO3My8r4oaZMynil4zCsGltZyZmcmFiCkltcG9ydFdhdmUg4oaQIFLigoAgUkkgU-KXjOKXjMKwYXVkaW8mZnJhYgpJbXBvcnRUYWJsZSDihpAg4oavT19TIFJJIFTil4zil4zCsGF1ZGlvJmZyYWIgIyBJbXBvcnQgMjU2LXdhdmUgdGFibGUKVGFibGVBdmVyYWdlIOKGkCBS4oKBw7dPLyvihq9PX1MgICAgICAgICAgICAjIFRhYmxlIHRvIHdhdmUgW1RhYmxlXQpUYWJsZUluZGV4IOKGkCBS4oKB4oqh4oanLTFP4oalMOKBhTrihq9PX1M6ICAgICAgICAjIFRhYmxlIHRvIHdhdmUgW0luZGV4ICgwLTI1NSksIFRhYmxlXQpJbWFnZVRvVGFibGUg4oaQIFVTCkdyYXBoQ29udiDihpAgR3JhcGggQSEo4qyaMMOX4oavUzEpCkdyYXBoU3BlY3RydW0g4oaQIElT4o2i4oqiKD0x4qe7KeKJoSjih4ziip7iiaXDt1NI4oehU0jiio9TVsO3RlbihpnDtzJT4oy1ZmZ0KeKWvT0w4oeh4oyKw7dHTCBPCkdyYXBoU3BlY3RydW1GdWxsIOKGkCBJU-KNouKKoig9MeKnuyniiaEo4oeM4oqe4omlw7dTSOKHoVNIw7dGVuKMtWZmdCnilr09MOKHoeKMisO3R0wgTwpXcml0ZUF1ZGlvIOKGkCAmZndh4oqCRFPijaUoJmZtZC4pRGVza3RvcCBPdXREaXJBdWRpb-KKguKKmSgiLndhdiJhdWRpbyJ3YXYiJmFzckPima0pCkV4aXQg4oaQIOKNpSgmZXhpdDApRGVza3RvcAoKIyAtLS0tIFNhbXBsZSB3YXZlZm9ybXMvd2F2ZXRhYmxlcwpXYXZl4oKBIOKGkCBBdmd7U2luMyBBbXAwLjdTaW4yIFNpbjF9CldhdmXigoIg4oaQIEFNMC40U2luNyBBTTAuNVNpbjIgU2luMQpXYXZl4oKCIOKGkCBBdmd7U2F3MSAoUHVsIDIgMC4yKX0KV2F2ZeKChCDihpAgQml0MC43IEZNMC4xU2luNyBTaW4xClRibOKCgSDihpAgRk0oVmFsIDAgMSkgU2luMiBTaW4xClRibOKCgiDihpAgTWF4IEF2Z3tBbXAoVmFsIDAgMSlTaW4yIFNpbjF9ClRibOKCgyDihpAgQml0KFZhbCAwIDEpIENycyhWYWxQSSAwIDEgMikgU2luMSBTaW4zCgpQcmludCAiVGJs4oKDIgpUZXN0IFRibOKCgwpJbWFnZSBUYmzigoMKR3JhcGggVGJs4oKDCkdyYXBoU3BlY3RydW0gVGJs4oKDCgpFeGl0Cg==

# TODO: high/low pass filters
# TODO: IR importing
# TODO: fix Str (stretch) buzzing
# TODO: Sid (side by side)
# TODO: Shp (waveshape)

S ← 2048                                  # Samples per oscillator
O ← 256                                   # Oscillators per table
T ← ×S O                                  # Samples per table
SU ← ÷2+1                                 # Signed to unsigned
US ← -1×2                                 # Unsigned to signed
OU ← ÷⟜⇡S                                 # Oscillator base, unsigned 0-1
OT ← ×τOU                                 # Oscillator base, trigonometric 0-2π
R ← ↯¤T                                   # Oscillator to table (repeat)
U ← ⍥(⊢⍉↯⊟:⟜÷2⊸⧻)                         # Octave up (for playback only)
GH ← 200                                  # Graph height
C ← ↥¯1↧1                                 # Clamp
SW ← ⊏◿⧻,                                 # Select (wrapped)
SI ← +⊙×⟜-⊃⊃(SW⌊)(SW⌈)(-⊸⌊)               # Select (interpolated)
RI ← SI×⇡:÷,⧻,                            # Resize (interpolated)
CS ← ∿+η                                  # Cosine
NR ← ↧⊸↥                                  # NaN replace
SC ← NR1÷⟜∿                               # Sinc
VB ← ÷-1⟜⇡O                               # Value base
VR ← +⊙×:-⟜:                              # Value range [min, max, values]
GL ← 16                                   # GIF length (frames)
SH ← 200                                  # Spectrum graph height
FV ← ÷2√S                                 # Fourier max value
SV ← +1⌊×÷2Sⁿ2÷⟜⇡÷4S                      # Spectrum index values
IS ← ⨬(&gifs15|&ims)=2⧻△.                 # Show image or gif
SM ← ⇌∧(⊂+⊸⊃⋅∘(×⊙⋅⊢))⊙(:¤°⊂)              # Scan add + multiply
MB ← ÷:1ⁿ16 2                             # Minimum 16-bit value
FT ← ⊃(∠°ℂ)(÷FV⌵)↙+1÷2S fft               # Fourier transform [phase, amp ← wave]
FU ← ◌°ℂ°fft⊂:⍜°ℂ¯↘1⇌↘1.ℂ⊃(×∿)(×CS)⊙(×FV) # Fourier untransform [wave ← phase, amp]
DS ← |1 ⍥(⊂:"/")>0⧻.
True ← 1  # True constant
False ← 0 # False constant
R₀ ← ☇0   # Rerank zero
R₁ ← ☇1   # Rerank one
V! ← R₁≡^!R₀
VV! ← R₁≡^!R₀⊙R₀
VVA! ← R₁≡^!R₀⊙R₀⊙⊙R₁
VA! ← R₁≡^!R₀⊙R₁
VAA! ← R₁≡^!R₀⊙R₁⊙⊙R₁
A! ← R₁≡^!R₁
AA! ← R₁≡^!R₁⊙R₁

# ---- Convolutions
# Identity (delta) convolution
CId ← ¤¤1

# ---- Table values
# Values (linear) [min, max]
Val ← VR⊙⊙(VB)
# Values (power in) [min, max, base]
ValPI ← VR⊙⊙(ⁿ:VB)
# Values (power out) [min, max, base]
ValPO ← ⇌ValPI:

# ---- Helpers
# Random (min-max) [Min, Max]
Rnd ← +×⚂:⟜-
# Random (min-max) [Min, Max]
RndI ← ⌊Rnd:+1:⍥:<,,

# ---- Wave Operations
# Sum [{Waves/Tables}]
Sum ← °□/+⍚R₁
# Average [{Waves/Tables}]
Avg ← Sum÷⊸⧻
# Amplify [Amount, Wave/Table]
Amp ← VA!×
# Maximize [Wave/Table]
Max ← A!(◌⍥⟜÷≠0.↥∩/↥⟜¯.)
# Phase shift [Amount, Wave/Table]
Phs ← VA!(↻⁅×⧻,)
# Phase shift to zero point [Wave/Table]
Zer ← A!(↻⊗/↧⌵..)
# Bitcrush [Amount (0-1), Wave/Table]
Bit ← VA!(US↧1÷-1:⌊×,SU:⁅ⁿ:2+1×15-:1√↧1↥0)
# Reverse [Wave/Table]
Rev ← A!⇌
# Invert [Wave/Table]
Inv ← A!¯
# Mirror 1st half [Wave/Table]
Mir ← A!(⊂⇌.↙÷2S)
# Fade start & end [Amount (0-1), Wave/Table]
Fad ← VA!(⇌⬚1×⇌:⬚1⟜×÷⧻.⇡⌊÷2×S↥0)
# Crossfade [Amount (0-1), Start Wave/Table, End Wave/Table]
Crs ← VAA!(+⊙(×-:1):⟜×⊙:)
# Stretch [To (0-1), From (0-1), Wave/Table]
Str ← VVA!(⊂⊙RI:-:S⟜RI⊙⊃↙↘∩(↧-1S↥1⁅×S↧1↥0))
# Shift up/down [Amount (¯1-1), Wave/Table]
Shf ← VA!(+)
# Slice [Amount (0-1), Wave/Table]
Slc ← VA!(RI S↯♭⁅↥1×S)
# Speed up/down [Octaves, Wave/Table]
Spd ← VA!(Slcⁿ:2)
# Splice [Amount (0-1), Wave/Table 1, Wave/Table 2]
Spl ← VAA!(⊂⊓↙↘⟜:⁅×S↧1↥0)
# Clip
Clp ← A!(C)
# Wrap [Wave/Table]
Wrp ← A!(US◿+MB1SU)
# Amplutude modulation [Amplitude, Modulator, Carrier]
AM ← VAA!(×+1÷2×-1:)
# Ring modulation [Modulator, Carrier]
RM ← AA!×
# Frequency modulation [Amplitude, Modulator, Carrier]
FM ← VAA!(SI×S+OU×)
# Convolve [Impulse, Wave/Table]
Cnv ← AA!(/+×⍉◫⊙(↯♭):-1⊸+⧻,⧻⟜:)
# Phase randomize [Amount (0-1), Wave/Table]
Phr ← ≡(FU:⊙+:FT):≡×R₁-π×τ⍥(⊂⚂)+1÷2S[]R₀⊙R₁
# Harmonic wave filter [Amount (0-1), Filter Wave/Table, Source Wave/Table]
Hwf ← VAA!(FU⊙×:+1×⊙(-1◌∩FT))
# Downsample [Amount (0-1), Wave/Table]
Dwn ← VA!(
  ⌈÷:S.⁅↥1ⁿ:2+1×-1ₙ2S-:1
  ↯¤S⍉↯⟜÷⟜(≡/+↯⊂:)
)

# ---- Table operations
# Comb filter (feedback) [Amplitude, Harmonic, Table]
TCmb ← ↯O_S SM⊙(⬚0↯⊂⌈÷:T.⁅÷:S⊙R)
# Comb filter (feedforward) [Amplitude, Harmonic, Table]
TCmf ← ↯O_S+×⊙(⊂↯:[0]¤⟜↘⌊÷:¯S⊙(.R))

# ---- Waveforms
# Sine wave [Harmonic]
Sin ← V!(∿×:OT)
# Saw wave [Harmonic]
Saw ← V!(US◿1×:OU)
# Triangle wave [Harmonic]
Tri ← V!(US⌵US◿1+0.25¯×:OU)
# Pulse wave [Harmonic, Duty]
Pul ← VV!(US≤US:Saw)
# Square wave [Harmonic]
Sqr ← V!(Pul:0.5)
# Noise wave []
Nsw ← (☇1US⍥(⊂⚂)S[])

# ---- Tables
# Noise table []
Nst ← (⍥(⊂Nsw)O[])

# ---- Settings
Desktop ← False
OutDirAudio ← "out"

# ---- Utility
Print ← &pf
Export ← &ap C♭
Test ← &ap U3R C♭
Graph ← IS⍢⊢(=1⧻)≡(⇌⬚1⊞≠⇡GH⁅×-1GH SU U2C)▽=0⇡⌊÷GL O
Image ← &ims↯O_S SU R C♭
ImportImage ← RI O≡RI S⍜⍉≡(÷3/+↙3)◌°img&frab
ImportWave ← R₀ RI S◌◌°audio&frab
ImportTable ← ↯O_S RI T◌◌°audio&frab # Import 256-wave table
TableAverage ← R₁÷O/+↯O_S            # Table to wave [Table]
TableIndex ← R₁⊡↧-1O↥0⁅:↯O_S:        # Table to wave [Index (0-255), Table]
ImageToTable ← US
GraphConv ← Graph A!(⬚0×↯S1)
GraphSpectrum ← IS⍢⊢(=1⧻)≡(⇌⊞≥÷SH⇡SH⊏SV÷FV↙÷2S⌵fft)▽=0⇡⌊÷GL O
GraphSpectrumFull ← IS⍢⊢(=1⧻)≡(⇌⊞≥÷SH⇡SH÷FV⌵fft)▽=0⇡⌊÷GL O
WriteAudio ← &fwa⊂DS⍥(&fmd.)Desktop OutDirAudio⊂⊙(".wav"audio"wav"&asrC♭)
Exit ← ⍥(&exit0)Desktop

# ---- Sample waveforms/wavetables
Wave₁ ← Avg{Sin3 Amp0.7Sin2 Sin1}
Wave₂ ← AM0.4Sin7 AM0.5Sin2 Sin1
Wave₂ ← Avg{Saw1 (Pul 2 0.2)}
Wave₄ ← Bit0.7 FM0.1Sin7 Sin1
Tbl₁ ← FM(Val 0 1) Sin2 Sin1
Tbl₂ ← Max Avg{Amp(Val 0 1)Sin2 Sin1}
Tbl₃ ← Bit(Val 0 1) Crs(ValPI 0 1 2) Sin1 Sin3

Print "Tbl₃"
Test Tbl₃
Image Tbl₃
Graph Tbl₃
GraphSpectrum Tbl₃

Exit
